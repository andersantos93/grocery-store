{% extends "master.html" %}

{% block title %}
  Basket
{% endblock %}

{% block content %}
<div class="d-flex justify-content-center g-2 mt-4">
  <div class="col-4">
    <h5>Add your items</h5>
    <form action="" method="post">
      {% csrf_token %}
      <div class="mt-3">
        {% comment %} <label for="products">{{ form.products.label }}</label> {% endcomment %}
        <select class="form-select" name="product" id="product-select">
          <option selected>Select one product</option>
          {% for product in products %}
            <option 
              value="{{ product.id }}"
              data-name="{{ product.name }}"
              data-price="{{ product.price }}">
              Product: {{ product.name }} | Price: {{ product.price }}
            </option>
          {% endfor %}
        </select>
        {% comment %} {{ form.products }} {% endcomment %}
      </div> 
      <div class="form-floating mt-3">
        {% comment %} {{ form.quantity }} {% endcomment %}
        {% comment %} <label for="quantity">{{ form.quantity.label }}</label> {% endcomment %}
        <input type="number" name="quantity" class="form-control" id="quantity" placeholder="Enter a quantity">
        <label for="quantity" class="form-label">Quantity</label>
      </div>
      <button type="button" onclick="addSelectedToBasket()" class="btn btn-primary mt-3">Add to your Basket</button>
      {% if msg %}
        <div class="alert alert-{{msg.code}} mt-4" role="alert">
          <strong>{{msg.label}}</strong>
        </div>
      {% endif %}
    </form>
    <h3>Your Basket</h3>
    <ul id="basket-list"></ul>
  </div>
</div>
<script>
   var basketList = [];

  function addSelectedToBasket() {
    const select = document.getElementById('product-select');
    const selectedOption = select.options[select.selectedIndex];

    if (!selectedOption.value) return;

    const id = selectedOption.value;
    const name = selectedOption.dataset.name;
    const price = parseFloat(selectedOption.dataset.price);
    const quantity = 

    const existing = basketList.find(item => item.id === id);
    if (existing) {
      existing.quantity += 1;
    } else {
      basketList.push({ id, name, price, quantity: 1 });
    }
    console.log("basket list", basketList);
    renderBasket();
  }

  function removeFromBasket(id) {
    let basket = basketList().filter(item => item.id !== id);
    basketList = basket;
    renderBasket();
  }

  function renderBasket() {
    const list = document.getElementById('basket-list');
    list.innerHTML = '';

    basketList.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} - $${item.price} x ${item.quantity}`;

      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'Remove';
      removeBtn.onclick = () => removeFromBasket(item.id);

      li.appendChild(removeBtn);
      list.appendChild(li);
    });
  }
</script>
{% endblock %}

